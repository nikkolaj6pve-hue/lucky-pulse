<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lucky Pulse: Ultimate Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #05050a; 
            --panel: rgba(255, 255, 255, 0.05); 
            --accent: #00f2ff;
            --gold: #ffcc00; 
            --prestige: #a020f0; 
            --text: #ffffff; 
            --green: #00ffa3; 
            --red: #ff3e3e;
            --card-br: 24px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            margin: 0; 
            background: var(--bg); 
            color: var(--text); 
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif; 
            overflow: hidden; 
            height: 100vh; 
        }

        #app { display: none; flex-direction: column; height: 100vh; padding: 15px; background: radial-gradient(circle at 50% -20%, #1a1a3a, #05050a); }
        
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–æ–≤ */
        .screen { display: none; flex-direction: column; height: 100%; overflow-y: auto; padding-bottom: 110px; }
        .screen.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* –í–∏–¥–∂–µ—Ç—ã */
        .glass { background: var(--panel); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08); border-radius: var(--card-br); padding: 20px; margin-bottom: 15px; }
        
        .hero-stats { 
            text-align: center; 
            padding: 30px 10px; 
            background: linear-gradient(145deg, rgba(0,242,255,0.05), rgba(0,0,0,0));
            border: 1px solid rgba(0,242,255,0.2);
        }
        
        .balance-main { font-size: 42px; font-weight: 900; letter-spacing: -1px; margin: 5px 0; font-variant-numeric: tabular-nums; }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã */
        .progress-container { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-top: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.1s linear; }

        /* –°–µ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-card { background: var(--panel); border-radius: 20px; padding: 12px; text-align: center; }

        /* –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ */
        .item-row { 
            display: flex; align-items: center; gap: 12px; padding: 12px; 
            background: rgba(255,255,255,0.03); border-radius: 20px; margin-bottom: 10px; 
            border: 1px solid transparent; position: relative; overflow: hidden;
        }
        .item-row:active { transform: scale(0.98); background: rgba(255,255,255,0.07); }
        .item-img { width: 50px; height: 50px; background: #111; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .tab-bar { 
            position: fixed; bottom: 15px; left: 15px; right: 15px; height: 70px; 
            background: rgba(15,15,25,0.95); backdrop-filter: blur(15px); border-radius: 25px; 
            display: flex; justify-content: space-around; align-items: center; 
            border: 1px solid rgba(255,255,255,0.1); z-index: 1000;
        }
        .tab { opacity: 0.4; transition: 0.3s; text-align: center; font-size: 10px; font-weight: bold; }
        .tab.active { opacity: 1; color: var(--accent); transform: translateY(-5px); }
        .tab i { display: block; font-size: 22px; margin-bottom: 4px; font-style: normal; }

        /* –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ */
        #toast { 
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%); 
            background: var(--accent); color: #000; padding: 10px 20px; 
            border-radius: 50px; font-weight: bold; z-index: 10000; display: none;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∫–ª–∏–∫–∞ */
        .click-anim { position: absolute; pointer-events: none; animation: fly 0.6s ease-out forwards; font-weight: 900; color: var(--accent); }
        @keyframes fly { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

    <div id="toast"></div>

    <div id="app">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding: 0 5px;">
            <div style="font-weight:900; font-size:12px; letter-spacing:1px; color:rgba(255,255,255,0.4)">LEVEL <span id="lvl-txt" style="color:var(--accent)">1</span></div>
            <div style="display:flex; gap:10px;">
                <div style="color:var(--gold); font-weight:bold; font-size:14px;">üíé <span id="stones-txt">0</span></div>
            </div>
        </div>

        <div id="sc-bank" class="screen active">
            <div class="glass hero-stats" onclick="handleTap(event)">
                <div style="font-size:10px; opacity:0.5; letter-spacing:2px;">CURRENT CAPITAL</div>
                <div class="balance-main">$<span id="bal-txt">0</span></div>
                <div style="display:flex; justify-content:center; gap:15px; font-size:12px; font-weight:bold;">
                    <span style="color:var(--green)">+$<span id="inc-txt">0</span>/s</span>
                    <span style="color:var(--accent)">‚ö°Ô∏è $<span id="click-txt">1</span>/tap</span>
                </div>
                <div class="progress-container"><div id="lvl-progress" class="progress-fill"></div></div>
            </div>

            <div class="grid-2">
                <div class="stat-card">
                    <div style="font-size:9px; opacity:0.5;">MULTIPLIER</div>
                    <div id="mult-txt" style="color:var(--prestige); font-weight:bold;">1.0x</div>
                </div>
                <div class="stat-card" onclick="prestige()">
                    <div style="font-size:9px; opacity:0.5;">PRESTIGE</div>
                    <div style="color:var(--gold); font-weight:bold;">RESET</div>
                </div>
            </div>

            <div class="glass">
                <div style="font-size:12px; font-weight:bold; margin-bottom:10px; display:flex; justify-content:space-between;">
                    <span>MARKET ANALYTICS</span>
                    <span id="mkt-trend" style="color:var(--green)">BULLISH</span>
                </div>
                <div id="chart-mini" style="height:40px; display:flex; align-items:flex-end; gap:3px;"></div>
            </div>
        </div>

        <div id="sc-assets" class="screen">
            <h3 style="margin-left:10px;">Business Empire</h3>
            <div id="biz-list" style="padding: 0 5px;"></div>
        </div>

        <div id="sc-upgrades" class="screen">
            <h3 style="margin-left:10px;">Tech Upgrades</h3>
            <div id="upg-list" style="padding: 0 5px;"></div>
        </div>

        <nav class="tab-bar">
            <div class="tab active" onclick="switchTab('bank', this)"><i>üè¶</i>BANK</div>
            <div class="tab" onclick="switchTab('assets', this)"><i>üíº</i>ASSETS</div>
            <div class="tab" onclick="switchTab('upgrades', this)"><i>‚ö°</i>UPGRADES</div>
        </nav>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.headerColor = '#05050a';

        let state = {
            bal: 0, 
            totalEarned: 0,
            stones: 0, 
            prestigeCount: 0,
            biz: [
                {id:0, name:"Lemonade Stand", cost:50, profit:1, lv:0, icon:"üçã"},
                {id:1, name:"Coffee Shop", cost:500, profit:8, lv:0, icon:"‚òï"},
                {id:2, name:"Tech Startup", cost:12000, profit:150, lv:0, icon:"üíª"},
                {id:3, name:"Crypto Exchange", cost:250000, profit:2800, lv:0, icon:"ü™ô"}
            ],
            upgrades: [
                {id:0, name:"Mega Cursor", cost:100, bonus:2, lv:0, type:"click", icon:"üñ±Ô∏è"},
                {id:1, name:"Neural Network", cost:1000, bonus:0.1, lv:0, type:"mult", icon:"üß†"}
            ]
        };

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        function load() {
            const saved = localStorage.getItem('pulse_v10');
            if(saved) state = JSON.parse(saved);
            renderAll();
            updateUI();
            initChart();
        }

        function save() {
            localStorage.setItem('pulse_v10', JSON.stringify(state));
        }

        // --- –ì–ï–ô–ú–ü–õ–ï–ô ---
        function handleTap(e) {
            const clickPower = (1 + (state.upgrades[0].lv * state.upgrades[0].bonus)) * (1 + state.stones);
            state.bal += clickPower;
            state.totalEarned += clickPower;
            
            showClickAnim(e, Math.floor(clickPower));
            tg.HapticFeedback.impactOccurred('light');
            updateUI();
        }

        function showClickAnim(e, val) {
            const div = document.createElement('div');
            div.className = 'click-anim';
            div.style.left = e.clientX + 'px';
            div.style.top = e.clientY + 'px';
            div.innerText = `+$${val}`;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 600);
        }

        function updateUI() {
            const income = state.biz.reduce((a, b) => a + (b.lv * b.profit), 0);
            const multiplier = 1 + (state.stones * 0.5) + (state.upgrades[1].lv * state.upgrades[1].bonus);
            const finalIncome = income * multiplier;

            document.getElementById('bal-txt').innerText = Math.floor(state.bal).toLocaleString();
            document.getElementById('inc-txt').innerText = Math.floor(finalIncome).toLocaleString();
            document.getElementById('stones-txt').innerText = state.stones;
            document.getElementById('mult-txt').innerText = multiplier.toFixed(1) + 'x';
            document.getElementById('click-txt').innerText = (1 + (state.upgrades[0].lv * state.upgrades[0].bonus)).toLocaleString();
            
            // –õ–µ–≤–µ–ª-–±–∞—Ä (—É—Å–ª–æ–≤–Ω—ã–π)
            const progress = (state.bal % 1000) / 10;
            document.getElementById('lvl-progress').style.width = progress + '%';
            
            save();
        }

        function renderAll() {
            // –†–µ–Ω–¥–µ—Ä –±–∏–∑–Ω–µ—Å–æ–≤
            const bList = document.getElementById('biz-list');
            bList.innerHTML = state.biz.map(b => `
                <div class="item-row" onclick="buyBiz(${b.id})">
                    <div class="item-img">${b.icon}</div>
                    <div style="flex:1">
                        <div style="font-weight:bold">${b.name} <span style="color:var(--accent)">Lvl ${b.lv}</span></div>
                        <div style="font-size:11px; opacity:0.6">Profit: +$${b.profit}/s</div>
                    </div>
                    <div style="font-weight:bold; color:var(--gold)">$${b.cost.toLocaleString()}</div>
                </div>
            `).join('');

            // –†–µ–Ω–¥–µ—Ä –∞–ø–≥—Ä–µ–π–¥–æ–≤
            const uList = document.getElementById('upg-list');
            uList.innerHTML = state.upgrades.map(u => `
                <div class="item-row" onclick="buyUpg(${u.id})">
                    <div class="item-img">${u.icon}</div>
                    <div style="flex:1">
                        <div style="font-weight:bold">${u.name} <span style="color:var(--prestige)">Lvl ${u.lv}</span></div>
                        <div style="font-size:11px; opacity:0.6">${u.type === 'click' ? '+Power' : '+Multiplier'}</div>
                    </div>
                    <div style="font-weight:bold; color:var(--gold)">$${u.cost.toLocaleString()}</div>
                </div>
            `).join('');
        }

        function buyBiz(id) {
            const b = state.biz[id];
            if(state.bal >= b.cost) {
                state.bal -= b.cost;
                b.lv++;
                b.cost = Math.floor(b.cost * 1.5);
                tg.HapticFeedback.notificationOccurred('success');
                renderAll();
                updateUI();
            } else {
                showToast("Not enough cash!");
                tg.HapticFeedback.notificationOccurred('error');
            }
        }

        function buyUpg(id) {
            const u = state.upgrades[id];
            if(state.bal >= u.cost) {
                state.bal -= u.cost;
                u.lv++;
                u.cost = Math.floor(u.cost * 2.2);
                tg.HapticFeedback.notificationOccurred('success');
                renderAll();
                updateUI();
            }
        }

        // --- –ù–û–í–´–ï –°–ò–°–¢–ï–ú–´ ---
        function prestige() {
            const reward = Math.floor(state.totalEarned / 1000000);
            if(reward < 1) {
                showToast(`Need $1M total to prestige!`);
                return;
            }
            if(confirm(`Reset progress for ${reward} Pulse Stones?`)) {
                state.stones += reward;
                state.bal = 0;
                state.totalEarned = 0;
                state.biz.forEach(b => { b.lv = 0; b.cost = b.cost / (1.2 * b.lv || 1); }); // —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å–±—Ä–æ—Å
                location.reload(); 
            }
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2000);
        }

        function initChart() {
            const chart = document.getElementById('chart-mini');
            for(let i=0; i<30; i++) {
                const bar = document.createElement('div');
                bar.style.flex = "1";
                bar.style.background = "var(--accent)";
                bar.style.opacity = Math.random();
                bar.style.height = (Math.random() * 100) + "%";
                bar.style.borderRadius = "2px";
                chart.appendChild(bar);
            }
        }

        function switchTab(id, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('sc-' + id).classList.add('active');
            el.classList.add('active');
            tg.HapticFeedback.impactOccurred('medium');
        }

        // –¶–∏–∫–ª –¥–æ—Ö–æ–¥–∞
        setInterval(() => {
            const income = state.biz.reduce((a, b) => a + (b.lv * b.profit), 0);
            const multiplier = 1 + (state.stones * 0.5) + (state.upgrades[1].lv * state.upgrades[1].bonus);
            if(income > 0) {
                const tick = (income * multiplier) / 10;
                state.bal += tick;
                state.totalEarned += tick;
                updateUI();
            }
        }, 100);

        window.onload = load;
    </script>
</body>
</html>
